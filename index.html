<!DOCTYPE html>
<html>
<head>
  <title>Annotation Entry Page</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    input, select, button { margin: 10px 0; display: block; }
    #linkBox { display: none; margin-top: 20px; }
  </style>
</head>
<body>

  <a href="#" onclick="showPasswordInput()" style="font-size: 12px; color: gray;">Admin Access</a>
  <div id="adminSection" style="display: none; margin-top: 10px;">
    <input type="password" id="adminPass" placeholder="Enter admin password" style="margin-bottom: 5px;">
    <button onclick="checkPassword()">Submit</button>
    <div id="resetBox" style="display: none;">
      <button onclick="resetRoles()" class="small-button">Reset Roles</button>
    </div>
  </div>

  <h2>Enter Annotation Session</h2>

  <label for="annotatorID">Annotator ID:</label>
  <input type="text" id="annotatorID" required>

  <label for="annotatorRole">Select Role:</label>
  <select id="annotatorRole">
    <option value="">-- Select --</option>
    <option value="annotator1">Annotator 1</option>
    <option value="annotator2">Annotator 2</option>
  </select>

  <button onclick="submitForm()">Start Annotating</button>

  <div id="linkBox">
    <p id="welcomeMessage"><strong>Welcome!</strong></p>
    <a href="annotation_system.html" target="_blank">Go to Annotation System</a>
  </div>

  <script>
    function showPasswordInput() {
      document.getElementById("adminSection").style.display = "block";
    }
    
    function checkPassword() {
      const password = document.getElementById("adminPass").value;
      const correct = "dylan0327"; // üîí CHANGE THIS to your secret password
    
      if (password === correct) {
        document.getElementById("resetBox").style.display = "block";
        alert("Access granted. You can now reset roles.");
      } else {
        alert("Incorrect password.");
      }
    }
    
    function resetRoles() {
      localStorage.removeItem('annotator1_taken');
      localStorage.removeItem('annotator2_taken');
      alert("Roles have been reset. Please refresh the page.");
    }

    function resetRoles() {
        localStorage.removeItem('annotator1_taken');
        localStorage.removeItem('annotator2_taken');
        alert("Roles have been reset. Please refresh the page.");
    }
    // Disable already taken roles on load
    window.onload = function () {
      if (localStorage.getItem('annotator1_taken') === 'true') {
        document.querySelector('option[value="annotator1"]').disabled = true;
      }
      if (localStorage.getItem('annotator2_taken') === 'true') {
        document.querySelector('option[value="annotator2"]').disabled = true;
      }
    };

    function submitForm() {
      const id = document.getElementById("annotatorID").value.trim();
      const role = document.getElementById("annotatorRole").value;

      if (!id || !role) {
        alert("Please enter your ID and select a role.");
        return;
      }

      if (localStorage.getItem(role + '_taken') === 'true') {
        alert(role + " is already taken on this browser.");
        return;
      }

      // Mark the role as taken
      localStorage.setItem(role + '_taken', 'true');

      document.getElementById("annotatorID").disabled = true;
      document.getElementById("annotatorRole").disabled = true;
      document.querySelector("button").disabled = true;

      // Update welcome message with ID and role
      const message = `Welcome, ${id}! You are now assigned as ${role}.`;
      document.getElementById("welcomeMessage").textContent = message;
      document.getElementById("linkBox").style.display = "block";

      // Redirect based on role
      if (role === "annotator1") {
        window.location.href = "https://crux-labeling-oracle-2.onrender.com/query"; // üîÅ Replace with real URL
      } else if (role === "annotator2") {
        window.location.href = "https://crux-labeling-annotator-2.onrender.com/query"; // üîÅ Replace with real URL
      }
    }
  </script>
</body>
</html>

