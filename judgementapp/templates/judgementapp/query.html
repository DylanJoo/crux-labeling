{% extends "judgementapp/base.html" %}

{% block content %}
{% load custom_tags %}

<div class="card">

<div class="card-body">
    <h5 class="card-title">Task 1 - Financial Signal Highlighting</h5>
    <p class="card-text">
        This task has two subtasks: (task 1a) span highlighting, and (task 1b) content classification.
        And below are some annotation instructions. 
        <h6 class="card-title">General guildline</h6>
        <ul>
            <li>Annotators should <b>avoid speculation</b> based on prior knowledge and 
                should not draw conclusions that require speculation or prior knowledge of the company.</li>
            <li>Annotators should be as <b>consistent</b> as they can be with respect to their own annotations.</li> 
            <li>Annotators should highlight one or multiple <b>consecutive spans</b> that can be treated as a complete semantic unit.</li>
        </ul>
    </p>

    <p class="card-text">
        <h6 class="card-title">Detail guildlines</h6>
        For task 1a, annotators should highlight one or multiple <b>consecutive spans</b> that can be treated as a complete semantic unit.<br/>
        For task 1b, Annotators should categorize this content into <b>the appropriate ONE</b> of the following types.
        <ul>
            <li><span class="text-secondary">Type 0: Trivial information.</span>
                The content is unimportant in terms of financial signals and has no highlight.</li>
            <li><span class="text-primary">Type 1: Company-specific knowledge.</span>
                e.g., Companyâ€™s operating information, expected business thoughts, previous operational experience.</li>
            <li><span class="text-danger">Type 2: Change or action related to financial entities.</span>
                e.g., Operational disclosure, financial status or YoY comparison. New products, services, business strategies. </li>
            <li><span class="text-warning">Type 3: Reasons for events in this period.</span>
                e.g., Aan event is "due to ...". as " ...", the event would change.</li>
            <li><span class="text-success">Type 4: Redirect messages.</span>
                The contents is saying that "please refer to ..." or "as discussed in ..."
            </li>
        </ul>
        Here are <a href="{{ request.path }}examples">some examples</a>.
    </p>
</div>
<div class="card text-left m-2">
    <form class="form-inline" action="" method="post"> {% csrf_token %}

    <div class="card-body row">
        <h6>ID: <i>{{query.qId}}</i> </h6>
        <h6>Number of oracle passages: {{ query.metadata.num_oracle_passages }} </h6>
    </div>

    <div class="card-body row">
        <h6>Open-ended Query (topic):</h6>
        <h6>{{ query.text }} </h6>

        <div class="col" align="left">
        <div class="btn-group btn-group-sm" role="group" aria-label="Basic checkbox toggle button group">
            <input type="checkbox" class="btn-check" name="topic" id="topic1" value="1"
            {% if query.topic.1 == 1%} checked {% endif %}>
            <label class="btn btn-outline-dark btn-sm" for="topic1">Report request</label>
        </div>
        </div>
    </div>

    <div class="card-body row">
        <h6>Report:</h6>
        <h6>{{ query.report }} </h6>
    </div>

    <div class="card-body row">
        <h6>Question-based Nuggets:</h6>

        <div><script type="text/javascript">
          function getSelectedText() {
              if (window.getSelection) {
                  return window.getSelection().toString();
              } else if (document.selection) {
                  return document.selection.createRange().text;
              }
              return '';
          }

          function captureSelection(i) {
            let query = {'nuggets': {{ query.nuggets|safe }}};
            textarea = document.getElementById('nugget-' + i);
            if (query.nuggets[i] == '') {
                query.nuggets[i] = getSelectedText();
            } else {
                query.nuggets[i] += ' ||| ' + getSelectedText();
            }
            textarea.value = query.nuggets[i];
          }
        </script></div>
        <div class="col float-left">
            {% for i, question in query.questions.items %}

            <h6> Q-{{i}} {{ question }}
                <button type="button" class="btn btn-warning btn-sm" id="capture" onclick="captureSelection({{ i }})">Nugget Highlighter</button>
	    <h6>

            <div class="control-group">
                <textarea style="width:100%" id="nugget-{{ i }}" name="nugget-{{ i }}" rows="2" cols="50">{{ query.nuggets|get_item:i }}</textarea>
            </div>
            {% endfor %}
        </div>

        <div class="col-2 align-self-end" align="right">
            <div class="form-actions">
                <button type="submit" class="btn btn-outline-primary btn-sm">Save</button> 
                <button type="submit" name="clear" value="1" class="btn btn-outline-danger btn-sm">Clear</button> 
            </div>
        </div>
    </div>


    <div class="card-body row">
        <div class="col">
            {% if prev %}
            <a href="{% url 'query' qId=prev.qId%}" class="btn btn-outline-dark btn-sm">Prev Query</a>
            {% endif %}
        </div>
        <div class="col" align="right">
            {% if next %}
            <a href="{% url 'query' qId=next.qId%}" class="btn btn-outline-dark btn-sm">Next Query</a>
            {% endif %}
        </div>
    </div>

    </form>

</div>

<div class="table-responsive m-2">
    <table class="table table-striped">
        <thead style="table-layout:fixed">
            <tr><th>No.</th>
                <th>Document#</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for judgement in judgements %}
            <tr><td>{{ forloop.counter }}</td>
                <td><a href="{% url 'document' qId=query.qId docId=judgement.document.docId %}">{{ judgement.document.docId }}</a></td>
                <td style="color: 
                            {% if judgement.relevance == -1 %} black {% endif %}
                            {% if judgement.relevance == 0 %} red {% endif %}
                            {% if judgement.relevance == 1 %} orange {% endif %}
                            {% if judgement.relevance == 2 %} green {% endif %} " >{{ judgement.label }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
</div>
{% endblock %}

